<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <title>Cubicador 3D – Pallets</title>

    <style>
        body{
            font-family: Arial;
            margin: 20px;
            background: #f1f1f1;
        }

        #contenedor{
            width: 1100px;
            margin: auto;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 0 15px rgba(0,0,0,0.1);
        }

        input{
            padding: 5px;
            width: 120px;
            margin-bottom: 10px;
        }

        #resultado{
            margin-top: 20px;
            font-size: 18px;
            font-weight: bold;
        }

        #vista3d{
            width: 900px;
            height: 500px;
            margin-top: 25px;
            background: #ccc;
        }
    </style>
</head>
<body>

<div id="contenedor">

    <h1>Cubicador 3D – Pallets</h1>

    <h3>Medidas del camión (en metros)</h3>

    Largo: <input id="cam_l" type="number" value="12.0"><br>
    Ancho: <input id="cam_a" type="number" value="2.4"><br>
    Alto:  <input id="cam_h" type="number" value="2.5"><br>

    <h3>Medidas del pallet</h3>

    Largo: <input id="pal_l" type="number" value="1.2"><br>
    Ancho: <input id="pal_a" type="number" value="1.0"><br>
    Alto:  <input id="pal_h" type="number" value="0.6"><br>

    <h3>Cantidad de pallets que quieres mover</h3>

    Cantidad: <input id="cantidad" type="number" value="20"><br>

    <button onclick="calcular()">Calcular</button>

    <div id="resultado"></div>

    <h2>Vista 3D</h2>
    <div id="vista3d"></div>

</div>


<!-- Three.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r152/three.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r152/examples/js/controls/OrbitControls.js"></script>


<script>

let renderer, scene, camera, controls;

// ======================================================
//                 FUNCIÓN PRINCIPAL DE CÁLCULO
// ======================================================
function calcular(){

    const camL = parseFloat(cam_l.value);
    const camA = parseFloat(cam_a.value);
    const camH = parseFloat(cam_h.value);

    const palL = parseFloat(pal_l.value);
    const palA = parseFloat(pal_a.value);
    const palH = parseFloat(pal_h.value);

    const deseados = parseInt(cantidad.value);

    // FILAS Y COLUMNAS
    const cols = Math.floor(camL / palL);
    const rows = Math.floor(camA / palA);

    // NIVELES
    const niveles = Math.floor(camH / palH);

    const maximo = cols * rows * niveles;

    let mensaje =
        "Máximo que caben: " + maximo + "<br>" +
        "Distribución: " + cols + " columnas × " + rows + " filas × " + niveles + " niveles<br><br>";

    if (deseados <= maximo){
        mensaje += "<span style='color:green'>✔ Sí caben los " + deseados + " pallets</span>";
    }else{
        mensaje += "<span style='color:red'>✘ No caben (" + deseados + " vs " + maximo + ")</span>";
    }

    document.getElementById("resultado").innerHTML = mensaje;

    dibujar3D(cols, rows, niveles, maximo, deseados);
}


// ======================================================
//                FUNCIÓN 3D COMPLETA – THREE.JS
// ======================================================
function dibujar3D(cols, rows, niveles, maximo, deseados){

    const usados = Math.min(deseados, maximo);

    const palletW = 1;    // Escalado
    const palletD = 1;
    const palletH = 0.5;

    const separacion = 0.1;

    // Crear escena y cámara solo una vez
    if (!renderer){

        scene = new THREE.Scene();
        scene.background = new THREE.Color(0xf0f0f0);

        camera = new THREE.PerspectiveCamera(
            45, 
            900/500,
            0.1, 
            1000
        );

        camera.position.set(10,10,14);

        renderer = new THREE.WebGLRenderer({ antialias:true });
        renderer.setSize(900,500);

        document.getElementById("vista3d").innerHTML = "";
        document.getElementById("vista3d").appendChild(renderer.domElement);

        controls = new THREE.OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;

    }

    // Limpiar escena
    while(scene.children.length > 0)
        scene.remove(scene.children[0]);

    // Luces
    const light = new THREE.DirectionalLight(0xffffff, 1);
    light.position.set(8,12,10);
    scene.add(light);

    scene.add(new THREE.AmbientLight(0xffffff, 0.4));

    // Dibujar pallets
    const totalPallets = Math.min(maximo, cols*rows*niveles);

    for (let i = 0; i < totalPallets; i++){

        const nivel = Math.floor(i / (cols*rows));
        const resto = i % (cols*rows);
        const fila = Math.floor(resto / cols);
        const col = resto % cols;

        const ocupado = i < usados;
        const color = ocupado ? 0x27ae60 : 0xaaaaaa;

        const geo = new THREE.BoxGeometry(palletW, palletH, palletD);
        const mat = new THREE.MeshStandardMaterial({ color });
        const pallet = new THREE.Mesh(geo, mat);

        pallet.position.set(
            col * (palletW + separacion),
            nivel * (palletH + separacion),
            fila * (palletD + separacion)
        );

        scene.add(pallet);
    }


    // Caja del camión (wireframe)
    const camGeo = new THREE.BoxGeometry(
        cols * (palletW + separacion) + 1,
        niveles * (palletH + separacion) + 1,
        rows * (palletD + separacion) + 1
    );

    const camMat = new THREE.MeshBasicMaterial({
        color: 0x0044ff,
        wireframe: true,
        transparent: true,
        opacity: 0.5
    });

    const camion = new THREE.Mesh(camGeo, camMat);
    camion.position.set(
        (cols*(palletW+separacion))/2,
        (niveles*(palletH+separacion))/2,
        (rows*(palletD+separacion))/2
    );

    scene.add(camion);

    // Animación
    function animar(){
        requestAnimationFrame(animar);
        controls.update();
        renderer.render(scene, camera);
    }
    animar();
}

</script>
</body>
</html>


