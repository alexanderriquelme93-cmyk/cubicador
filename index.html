<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Calculadora de Cubicaci√≥n</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 1100px;
      margin: 20px auto;
      padding: 10px 20px;
    }
    h1 {
      text-align: center;
      margin-bottom: 10px;
    }
    h2 {
      margin-top: 0;
      font-size: 1.1rem;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 18px;
      margin-bottom: 20px;
    }
    .card {
      border: 1px solid #ccc;
      border-radius: 8px;
      padding: 12px 14px;
    }
    label {
      display: block;
      margin-top: 6px;
      font-size: 0.9rem;
    }
    input, select {
      width: 100%;
      padding: 4px 6px;
      margin-top: 2px;
      box-sizing: border-box;
    }
    button {
      margin-top: 10px;
      padding: 8px 16px;
      cursor: pointer;
    }
    .resultado {
      margin-top: 8px;
      padding: 10px;
      border-radius: 6px;
      border: 1px solid #ccc;
      background: #fafafa;
    }
    .small {
      font-size: 0.8rem;
      color: #555;
    }
    .status-ok {
      color: #0a7a0a;
      font-weight: bold;
    }
    .status-bad {
      color: #b00020;
      font-weight: bold;
    }
    table.resumen {
      border-collapse: collapse;
      width: 100%;
      margin-top: 6px;
    }
    table.resumen th,
    table.resumen td {
      border: 1px solid #ccc;
      padding: 6px 8px;
      text-align: right;
      font-size: 0.9rem;
    }
    table.resumen th:first-child,
    table.resumen td:first-child {
      text-align: left;
    }
    table.resumen th {
      background: #eee;
    }
  </style>
</head>
<body>
  <h1>Calculadora de Cubicaci√≥n</h1>
  <p class="small">
    Calculadora para camiones / contenedores seg√∫n medidas y pallets. Incluye niveles apilables y sugerencias de transporte.
  </p>

  <h2 style="margin-top:20px;">Cantidad de pallets que quiero cargar</h2>
  <div style="margin-bottom:18px;">
    <input
      id="palDeseados"
      type="number"
      step="1"
      value="0"
      style="
        font-size:1.4rem;
        padding:8px 10px;
        width:200px;
        border:2px solid #444;
        border-radius:6px;
        font-weight:bold;
      "
    />
    <div class="small" style="margin-top:4px;">
      * Si dejas la cantidad en 0, se muestra solo la capacidad m√°xima del cami√≥n.
    </div>
  </div>

  <div class="grid">
    <!-- CAMI√ìN -->
    <div class="card">
      <h2>Cami√≥n / Contenedor</h2>

      <label>Tipo de cami√≥n
        <select id="truckSelect">
          <option value="hino916">Hino 916</option>
          <option value="atego1729">Mercedes-Benz Atego 1729</option>
          <option value="volvofl240" selected>Volvo FL 240</option>
          <option value="camion34">Cami√≥n 3/4</option>
          <option value="camionSimple">Cami√≥n Simple</option>
          <option value="camionRampla">Cami√≥n Rampla 40'</option>
          <option value="camionTermico">Cami√≥n T√©rmico</option>
          <option value="camionHighCube">Contenedor High Cube 40'</option>
          <option value="contenedor20">Contenedor 20'</option>
          <option value="contenedor40">Contenedor 40'</option>
        </select>
      </label>

      <label>Largo (m)
        <input id="truckLargo" type="number" step="0.01" />
      </label>

      <label>Ancho (m)
        <input id="truckAncho" type="number" step="0.01" />
      </label>

      <label>Alto interno (m)
        <input id="truckAlto" type="number" step="0.01" />
      </label>

      <label>Capacidad (kg)
        <input id="truckCapacidad" type="number" step="1" />
      </label>

      <label>Valor viaje (CLP)
        <input id="valorViaje" type="number" step="1000" value="95000" />
      </label>
    </div>

    <!-- PALLET -->
    <div class="card">
      <h2>Pallet</h2>

      <label>Tipo de pallet
        <select id="palletSelect">
          <option value="eu">Pallet Europeo (1.2 √ó 0.8)</option>
          <option value="us" selected>Pallet Americano (1.2 √ó 1.0)</option>
        </select>
      </label>

      <label>Largo pallet (m)
        <input id="palLargo" type="number" step="0.01" />
      </label>

      <label>Ancho pallet (m)
        <input id="palAncho" type="number" step="0.01" />
      </label>

      <label>Alto pallet (m)
        <input id="palAlto" type="number" step="0.01" value="0.7" />
      </label>

      <!-- NIVELES APILABLES -->
      <label>Niveles apilables m√°ximos
        <input id="nivelesApilables" type="number" step="1" min="1" value="1" />
      </label>
    </div>
  </div>

  <button onclick="calcular()">Calcular cubicaci√≥n</button>

  <div id="mensaje" class="small" style="margin-top:8px;"></div>
  <div id="sugerencia" class="small" style="margin-top:4px;"></div>
  <div id="salida" class="resultado"></div>

  <script>
    // Datos de camiones
    const trucks = {
      hino916: { nombre:"Hino 916", largo:5.4, ancho:2.2, alto:2.1, capacidad:3800 },
      atego1729: { nombre:"Mercedes-Benz Atego 1729", largo:7.3, ancho:2.4, alto:2.3, capacidad:11500 },
      volvofl240: { nombre:"Volvo FL 240", largo:6.2, ancho:2.3, alto:2.2, capacidad:6800 },
      camion34: { nombre:"Cami√≥n 3/4", largo:4.5, ancho:2.2, alto:2.1, capacidad:3000 },
      camionSimple: { nombre:"Cami√≥n Simple", largo:7.0, ancho:2.4, alto:2.4, capacidad:10000 },
      camionRampla: { nombre:"Cami√≥n Rampla 40'", largo:12.5, ancho:2.4, alto:2.4, capacidad:28000 },
      camionTermico: { nombre:"Cami√≥n T√©rmico", largo:8.0, ancho:2.4, alto:2.5, capacidad:12000 },
      camionHighCube: { nombre:"Contenedor High Cube 40'", largo:12.03, ancho:2.35, alto:2.69, capacidad:26000 },
      contenedor20: { nombre:"Contenedor 20'", largo:5.90, ancho:2.35, alto:2.39, capacidad:28000 },
      contenedor40: { nombre:"Contenedor 40'", largo:12.03, ancho:2.35, alto:2.39, capacidad:30000 }
    };

    // Pallets
    const pallets = {
      eu: { nombre:"Pallet Europeo", largo:1.2, ancho:0.8 },
      us: { nombre:"Pallet Americano", largo:1.2, ancho:1.0 }
    };

    // Inputs
    const truckSelect = document.getElementById("truckSelect");
    const truckLargo = document.getElementById("truckLargo");
    const truckAncho = document.getElementById("truckAncho");
    const truckAlto = document.getElementById("truckAlto");
    const truckCapacidad = document.getElementById("truckCapacidad");
    const valorViajeInput = document.getElementById("valorViaje");
    const palLargo = document.getElementById("palLargo");
    const palAncho = document.getElementById("palAncho");
    const palAlto = document.getElementById("palAlto");
    const palDeseados = document.getElementById("palDeseados");
    const nivelesApilablesInput = document.getElementById("nivelesApilables");

    const salida = document.getElementById("salida");
    const mensaje = document.getElementById("mensaje");
    const sugerenciaDiv = document.getElementById("sugerencia");

    window.addEventListener("load", () => {
      actualizarCamion();
      actualizarPallet();
      calcular();
    });

    truckSelect.addEventListener("change", () => { actualizarCamion(); calcular(); });
    document.getElementById("palletSelect").addEventListener("change", () => { actualizarPallet(); calcular(); });
    nivelesApilablesInput.addEventListener("input", calcular);

    function actualizarCamion(){
      const t = trucks[truckSelect.value];
      truckLargo.value=t.largo;
      truckAncho.value=t.ancho;
      truckAlto.value=t.alto;
      truckCapacidad.value=t.capacidad;
    }

    function actualizarPallet(){
      const p = pallets[document.getElementById("palletSelect").value];
      palLargo.value=p.largo;
      palAncho.value=p.ancho;
    }

    function capacidadPalletsCamion(Lc,Ac,Hc,Lp,Ap,Hp,nivelesApilables){
      const volPallet = Lp*Ap*Hp;
      const volCamion = Lc*Ac*Hc;

      const palletsAncho = Math.floor(Ac/Ap);
      const palletsLargo = Math.floor(Lc/Lp);

      const nivelesMaxGeom = Math.floor(Hc/Hp);
      const nivelesValidos = Math.max(1, Math.floor(nivelesApilables));
      const palletsAlto = Math.min(nivelesMaxGeom,nivelesValidos);

      const palletsRejilla = palletsAncho*palletsLargo*palletsAlto;
      const maxPorVolumen = Math.floor(volCamion/volPallet);

      let maximo = Math.min(maxPorVolumen,palletsRejilla);
      if(maximo===0) maximo=1;

      return{
        maximo,
        palletsAncho,
        palletsLargo,
        palletsAlto,
        volPallet,
        volCamion,
        maxPorVolumen,
        palletsRejilla
      };
    }

    function sugerirTransporte(deseados,Lp,Ap,Hp,niveles){
      if(deseados<=0)return null;

      let mejor=null;

      for(const k in trucks){
        const t=trucks[k];
        const c=capacidadPalletsCamion(t.largo,t.ancho,t.alto,Lp,Ap,Hp,niveles).maximo;

        if(c>=deseados){
          if(!mejor || c<mejor.capacidadPallets){
            mejor={ id:k, nombre:t.nombre, capacidadPallets:c };
          }
        }
      }
      return mejor;
    }

    function calcular(){
      const Lc=parseFloat(truckLargo.value);
      const Ac=parseFloat(truckAncho.value);
      const Hc=parseFloat(truckAlto.value);
      const valorViaje=parseFloat(valorViajeInput.value)||0;

      const Lp=parseFloat(palLargo.value);
      const Ap=parseFloat(palAncho.value);
      const Hp=parseFloat(palAlto.value);
      const deseados=parseInt(palDeseados.value)||0;
      const niveles=parseInt(nivelesApilablesInput.value)||1;

      // RESTRICCI√ìN üìåüìåüìå
      const alturaTotal = Hp * niveles;
      if (alturaTotal > Hc) {
        mensaje.textContent =
          `‚ö† ERROR: La altura total apilada (${alturaTotal.toFixed(2)} m) ` +
          `supera la altura interna del cami√≥n (${Hc} m). Reduce niveles o altura del pallet.`;
        mensaje.className = "small status-bad";
        salida.innerHTML = "";
        sugerenciaDiv.textContent = "";
        return; // BLOQUEA C√ÅLCULO
      }

      const datos=capacidadPalletsCamion(Lc,Ac,Hc,Lp,Ap,Hp,niveles);
      const {maximo,palletsAncho,palletsLargo,palletsAlto,volPallet,volCamion}=datos;

      // Valor por m¬≥
      const valorPorM3 = volCamion>0 ? valorViaje/volCamion : 0;

      let msg="";
      if(deseados<=maximo){
        msg=`Los ${deseados} pallets CABEN.`;
      } else {
        msg=`‚ö† Los ${deseados} pallets NO CABEN. Capacidad m√°xima: ${maximo}.`;
      }

      mensaje.textContent=msg;
      mensaje.className=deseados<=maximo?"small status-ok":"small status-bad";

      salida.innerHTML = `
        <p class="small"><b>Valor m¬≥:</b> ${valorPorM3.toFixed(0)} CLP/m¬≥</p>
        <table class="resumen">
          <tr><th>Concepto</th><th>Valor</th></tr>
          <tr><td>Pallets m√°ximo</td><td>${maximo}</td></tr>
          <tr><td>Volumen cami√≥n (m¬≥)</td><td>${volCamion.toFixed(2)}</td></tr>
          <tr><td>Volumen pallet (m¬≥)</td><td>${volPallet.toFixed(2)}</td></tr>
          <tr><td>Pallets por ancho</td><td>${palletsAncho}</td></tr>
          <tr><td>Pallets por largo</td><td>${palletsLargo}</td></tr>
          <tr><td>Niveles usados</td><td>${palletsAlto}</td></tr>
        </table>
      `;
    }
  </script>
</body>
</html>
