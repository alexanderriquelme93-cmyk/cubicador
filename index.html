<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Calculadora de Cubicaci√≥n</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 1100px;
      margin: 20px auto;
      padding: 10px 20px;
    }
    h1 {
      text-align: center;
      margin-bottom: 10px;
    }
    h2 {
      margin-top: 0;
      font-size: 1.1rem;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 18px;
      margin-bottom: 20px;
    }
    .card {
      border: 1px solid #ccc;
      border-radius: 8px;
      padding: 12px 14px;
    }
    label {
      display: block;
      margin-top: 6px;
      font-size: 0.9rem;
    }
    input, select {
      width: 100%;
      padding: 4px 6px;
      margin-top: 2px;
      box-sizing: border-box;
    }
    button {
      margin-top: 10px;
      padding: 8px 16px;
      cursor: pointer;
    }
    .resultado {
      margin-top: 8px;
      padding: 10px;
      border-radius: 6px;
      border: 1px solid #ccc;
      background: #fafafa;
    }
    .small {
      font-size: 0.8rem;
      color: #555;
    }
    .status-ok {
      color: #0a7a0a;
      font-weight: bold;
    }
    .status-bad {
      color: #b00020;
      font-weight: bold;
    }
    table.resumen {
      border-collapse: collapse;
      width: 100%;
      margin-top: 6px;
    }
    table.resumen th,
    table.resumen td {
      border: 1px solid #ccc;
      padding: 6px 8px;
      text-align: right;
      font-size: 0.9rem;
    }
    table.resumen th:first-child,
    table.resumen td:first-child {
      text-align: left;
    }
    table.resumen th {
      background: #eee;
    }
  </style>
</head>
<body>
  <h1>Calculadora de Cubicaci√≥n</h1>
  <p class="small">
    Basado en tu Excel: tipos de camiones, tipos de pallet y c√°lculo de m√°ximo
    de pallets por cami√≥n (rejilla vs volumen). Considera niveles apilables,
    sugiere tipo de transporte y calcula cu√°ntos camiones necesitas si te pasas.
  </p>

  <!-- CAMPO DESTACADO DE CANTIDAD DE PALLETS -->
  <h2 style="margin-top:20px;">Cantidad de pallets que quiero cargar</h2>
  <div style="margin-bottom:18px;">
    <input
      id="palDeseados"
      type="number"
      step="1"
      value="0"
      style="
        font-size:1.4rem;
        padding:8px 10px;
        width:200px;
        border:2px solid #444;
        border-radius:6px;
        font-weight:bold;
      "
    />
    <div class="small" style="margin-top:4px;">
      * Si dejas la cantidad en 0, se muestra solo la capacidad m√°xima del cami√≥n.
    </div>
  </div>

  <div class="grid">
    <!-- CAMI√ìN -->
    <div class="card">
      <h2>Cami√≥n / Contenedor</h2>

      <label>Tipo de cami√≥n
        <select id="truckSelect">
          <option value="hino916">Hino 916</option>
          <option value="atego1729">Mercedes-Benz Atego 1729</option>
          <option value="volvofl240" selected>Volvo FL 240</option>
          <option value="camion34">Cami√≥n 3/4</option>
          <option value="camionSimple">Cami√≥n Simple</option>
          <option value="camionRampla">Cami√≥n Rampla 40'</option>
          <option value="camionTermico">Cami√≥n T√©rmico</option>
          <option value="camionHighCube">Contenedor High Cube 40'</option>
          <option value="contenedor20">Contenedor 20'</option>
          <option value="contenedor40">Contenedor 40'</option>
        </select>
      </label>

      <label>Largo (m)
        <input id="truckLargo" type="number" step="0.01" />
      </label>

      <label>Ancho (m)
        <input id="truckAncho" type="number" step="0.01" />
      </label>

      <label>Alto interno (m)
        <input id="truckAlto" type="number" step="0.01" />
      </label>

      <label>Capacidad (kg)
        <input id="truckCapacidad" type="number" step="1" />
      </label>

      <label>Valor viaje (CLP)
        <input id="valorViaje" type="number" step="1000" value="95000" />
      </label>
    </div>

    <!-- PALLET -->
    <div class="card">
      <h2>Pallet</h2>

      <label>Tipo de pallet
        <select id="palletSelect">
          <option value="eu">Pallet Europeo (1.2 √ó 0.8)</option>
          <option value="us" selected>Pallet Americano (1.2 √ó 1.0)</option>
        </select>
      </label>

      <label>Largo pallet (m)
        <input id="palLargo" type="number" step="0.01" />
      </label>

      <label>Ancho pallet (m)
        <input id="palAncho" type="number" step="0.01" />
      </label>

      <label>Alto pallet (m)
        <input id="palAlto" type="number" step="0.01" value="0.7" />
      </label>

      <!-- NUEVO: NIVELES APILABLES -->
      <label>Niveles apilables m√°ximos
        <input id="nivelesApilables" type="number" step="1" min="1" value="1" />
      </label>
    </div>
  </div>

  <button onclick="calcular()">Calcular cubicaci√≥n</button>

  <div id="mensaje" class="small" style="margin-top:8px;"></div>
  <div id="sugerencia" class="small" style="margin-top:4px;"></div>
  <div id="salida" class="resultado"></div>

  <script>
    // Datos base: camiones / contenedores
    const trucks = {
      hino916: { nombre: "Hino 916", largo: 5.4, ancho: 2.2, alto: 2.1, capacidad: 3800 },
      atego1729: { nombre: "Mercedes-Benz Atego 1729", largo: 7.3, ancho: 2.4, alto: 2.3, capacidad: 11500 },
      volvofl240: { nombre: "Volvo FL 240", largo: 6.2, ancho: 2.3, alto: 2.2, capacidad: 6800 },
      camion34: { nombre: "Cami√≥n 3/4", largo: 4.5, ancho: 2.2, alto: 2.1, capacidad: 3000 },
      camionSimple: { nombre: "Cami√≥n Simple", largo: 7.0, ancho: 2.4, alto: 2.4, capacidad: 10000 },
      camionRampla: { nombre: "Cami√≥n Rampla 40'", largo: 12.5, ancho: 2.4, alto: 2.4, capacidad: 28000 },
      camionTermico: { nombre: "Cami√≥n T√©rmico", largo: 8.0, ancho: 2.4, alto: 2.5, capacidad: 12000 },
      camionHighCube: { nombre: "Contenedor High Cube 40'", largo: 12.03, ancho: 2.35, alto: 2.69, capacidad: 26000 },
      contenedor20: { nombre: "Contenedor 20'", largo: 5.90, ancho: 2.35, alto: 2.39, capacidad: 28000 },
      contenedor40: { nombre: "Contenedor 40'", largo: 12.03, ancho: 2.35, alto: 2.39, capacidad: 30000 }
    };

    const pallets = {
      eu: { nombre: "Pallet Europeo", largo: 1.2, ancho: 0.8 },
      us: { nombre: "Pallet Americano", largo: 1.2, ancho: 1.0 }
    };

    // Referencias a inputs
    const truckSelect = document.getElementById("truckSelect");
    const truckLargo = document.getElementById("truckLargo");
    const truckAncho = document.getElementById("truckAncho");
    const truckAlto = document.getElementById("truckAlto");
    const truckCapacidad = document.getElementById("truckCapacidad");
    const valorViajeInput = document.getElementById("valorViaje");
    const palLargo = document.getElementById("palLargo");
    const palAncho = document.getElementById("palAncho");
    const palAlto = document.getElementById("palAlto");
    const palDeseados = document.getElementById("palDeseados");
    const nivelesApilablesInput = document.getElementById("nivelesApilables");
    const salida = document.getElementById("salida");
    const mensaje = document.getElementById("mensaje");
    const sugerenciaDiv = document.getElementById("sugerencia");

    // Inicializaci√≥n de formulario
    window.addEventListener("load", () => {
      actualizarCamion();
      actualizarPallet();
      calcular();
    });

    truckSelect.addEventListener("change", () => {
      actualizarCamion();
      calcular();
    });
    document.getElementById("palletSelect").addEventListener("change", () => {
      actualizarPallet();
      calcular();
    });
    nivelesApilablesInput.addEventListener("input", calcular);
    palDeseados.addEventListener("input", calcular);
    valorViajeInput.addEventListener("input", calcular);

    function actualizarCamion() {
      const sel = truckSelect.value;
      const t = trucks[sel];
      truckLargo.value = t.largo;
      truckAncho.value = t.ancho;
      truckAlto.value = t.alto;
      truckCapacidad.value = t.capacidad;
    }

    function actualizarPallet() {
      const sel = document.getElementById("palletSelect").value;
      const p = pallets[sel];
      palLargo.value = p.largo;
      palAncho.value = p.ancho;
    }

    // Calcula capacidad m√°xima de pallets para un cami√≥n
    // nivelesApilables = cu√°ntos niveles m√°ximo me autorizan (operaci√≥n)
    function capacidadPalletsCamion(Lc, Ac, Hc, Lp, Ap, Hp, nivelesApilables) {
      const volPallet = Lp * Ap * Hp;
      const volCamion = Lc * Ac * Hc;

      const palletsAncho = Math.floor(Ac / Ap);
      const palletsLargo = Math.floor(Lc / Lp);

      const nivelesMaxGeom = Math.floor(Hc / Hp);
      const nivelesValidos = Math.max(1, Math.floor(nivelesApilables || 1));
      const palletsAlto = Math.min(nivelesMaxGeom, nivelesValidos);

      const palletsRejilla = palletsAncho * palletsLargo * palletsAlto;
      const maxPorVolumen = Math.floor(volCamion / volPallet);

      let maximo = Math.min(maxPorVolumen, palletsRejilla);
      if (maximo === 0) maximo = 1;

      return {
        maximo,
        palletsAncho,
        palletsLargo,
        palletsAlto,
        volPallet,
        volCamion,
        maxPorVolumen,
        palletsRejilla
      };
    }

    // Busca el cami√≥n m√°s peque√±o que pueda cargar los pallets deseados
    // usando los mismos niveles apilables que defini√≥ el usuario
    function sugerirTransporte(deseados, Lp, Ap, Hp, nivelesApilables) {
      if (deseados <= 0) return null;

      let mejor = null;

      for (const key in trucks) {
        const t = trucks[key];
        const cap = capacidadPalletsCamion(
          t.largo,
          t.ancho,
          t.alto,
          Lp,
          Ap,
          Hp,
          nivelesApilables
        ).maximo;

        if (cap >= deseados) {
          if (!mejor || cap < mejor.capacidadPallets) {
            mejor = {
              id: key,
              nombre: t.nombre,
              capacidadPallets: cap
            };
          }
        }
      }
      return mejor;
    }

    function calcular() {
      const Lc = parseFloat(truckLargo.value);
      const Ac = parseFloat(truckAncho.value);
      const Hc = parseFloat(truckAlto.value);
      const capacidadKg = parseFloat(truckCapacidad.value) || 0;
      const valorViaje = parseFloat(valorViajeInput.value) || 0;

      const Lp = parseFloat(palLargo.value);
      const Ap = parseFloat(palAncho.value);
      const Hp = parseFloat(palAlto.value);
      const deseados = parseInt(palDeseados.value, 10) || 0;
      const nivelesApilables = parseInt(nivelesApilablesInput.value, 10) || 1;

      if (!Lc || !Ac || !Hc || !Lp || !Ap || !Hp) {
        salida.innerHTML = "";
        mensaje.textContent = "Faltan datos. Revisa que todas las medidas tengan un valor v√°lido.";
        sugerenciaDiv.textContent = "";
        return;
      }

      const datos = capacidadPalletsCamion(
        Lc,
        Ac,
        Hc,
        Lp,
        Ap,
        Hp,
        nivelesApilables
      );

      const {
        maximo,
        palletsAncho,
        palletsLargo,
        palletsAlto,
        volPallet,
        volCamion,
        maxPorVolumen,
        palletsRejilla
      } = datos;

      const valorPorM3 = volCamion > 0 ? valorViaje / volCamion : 0;

      // mensaje principal + cantidad de camiones necesarios si me paso
      let mensajeTexto = "";
      if (deseados <= 0) {
        mensajeTexto = "No ingresaste cantidad de pallets, se muestra solo la capacidad m√°xima del cami√≥n.";
      } else if (deseados <= maximo) {
        mensajeTexto = `üëâ Los ${deseados} pallets que quieres C A B E N en este cami√≥n (m√°ximo permitido: ${maximo}).`;
      } else {
        mensajeTexto = `‚ö† Los ${deseados} pallets que quieres NO CABEN. Capacidad m√°xima de este cami√≥n: ${maximo}.`;
        if (maximo > 0) {
          const camionesNecesarios = Math.ceil(deseados / maximo);
          mensajeTexto += ` Necesitas aproximadamente ${camionesNecesarios} cami√≥n(es) de este mismo tipo para transportar los ${deseados} pallets.`;
        }
      }

      mensaje.textContent = mensajeTexto;
      mensaje.className =
        deseados === 0
          ? "small"
          : deseados <= maximo
          ? "small status-ok"
          : "small status-bad";

      // sugerencia de transporte (si me paso o si me falta)
      let sugerenciaTexto = "";
      if (deseados > 0) {
        const sugerido = sugerirTransporte(deseados, Lp, Ap, Hp, nivelesApilables);
        const idActual = truckSelect.value;

        if (deseados > maximo) {
          // Estoy pasado: sugerir uno m√°s grande
          if (sugerido) {
            sugerenciaTexto =
              `Sugerencia de transporte: el cami√≥n seleccionado no alcanza. ` +
              `Podr√≠as usar "${sugerido.nombre}", con capacidad aprox. de ` +
              `${sugerido.capacidadPallets} pallets para estas dimensiones ` +
              `(considerando hasta ${nivelesApilables} nivel(es) apilables).`;
          } else {
            sugerenciaTexto =
              "No se encontr√≥ un tipo de transporte en la lista que pueda cargar esa cantidad de pallets con estas dimensiones.";
          }
        } else {
          // Cabe, pero vemos si hay uno m√°s peque√±o que tambi√©n sirva
          if (sugerido && sugerido.id !== idActual && sugerido.capacidadPallets < maximo) {
            sugerenciaTexto =
              `Sugerencia de optimizaci√≥n: con ${deseados} pallets podr√≠as usar un cami√≥n m√°s peque√±o, ` +
              `por ejemplo "${sugerido.nombre}" (capacidad aprox. ${sugerido.capacidadPallets} pallets, ` +
              `hasta ${nivelesApilables} nivel(es) apilables).`;
          } else {
            sugerenciaTexto =
              "El tipo de cami√≥n seleccionado es adecuado para esta cantidad de pallets.";
          }
        }
      }
      sugerenciaDiv.textContent = sugerenciaTexto;

      // === TABLA DE USO NUM√âRICO Y PORCENTUAL ===
      const usadosPallets = deseados > 0 ? Math.min(deseados, maximo) : 0;
      const usoPallets = maximo > 0 ? (usadosPallets / maximo) * 100 : 0;

      const volUsado = usadosPallets * volPallet;
      const usoVol = volCamion > 0 ? (volUsado / volCamion) * 100 : 0;

      const tablaHTML = `
        <table class="resumen">
          <tr>
            <th>Concepto</th>
            <th>Usado</th>
            <th>Capacidad</th>
            <th>Uso (%)</th>
          </tr>
          <tr>
            <td>Pallets</td>
            <td>${usadosPallets}</td>
            <td>${maximo}</td>
            <td>${usoPallets.toFixed(1)} %</td>
          </tr>
          <tr>
            <td>Volumen (m¬≥)</td>
            <td>${volUsado.toFixed(3)}</td>
            <td>${volCamion.toFixed(3)}</td>
            <td>${usoVol.toFixed(1)} %</td>
          </tr>
        </table>
        <p class="small">
          Cami√≥n: ${Lc.toFixed(2)}m (L) √ó ${Ac.toFixed(2)}m (A) √ó ${Hc.toFixed(2)}m (H) |
          Pallet: ${Lp.toFixed(2)}m (L) √ó ${Ap.toFixed(2)}m (A) √ó ${Hp.toFixed(2)}m (H) |
          Valor por m¬≥: ${valorPorM3.toFixed(0)} CLP/m¬≥ |
          Niveles apilables: ${nivelesApilables}
        </p>
      `;

      salida.innerHTML = tablaHTML;
    }
  </script>
</body>
</html>
